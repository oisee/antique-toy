# 8-битный Ренессанс: Глубокое погружение в Z80 и 65C02 на реальном железе

## Целевые платформы

| Платформа | CPU | Тактовая | RAM | Графика | Звук |
|-----------|-----|----------|-----|---------|------|
| ZX Spectrum 128K (+ клоны) | Z80A | 3.5 MHz (7 MHz turbo на клонах) | 128KB (банки) | ULA, 256×192, атрибуты 8×8 | AY-3-8910 |
| Agon Light 2 | eZ80 | 18.432 MHz | 512KB flat | VDP (ESP32 + FabGL) | ESP32 audio |
| NEO6502 | 65C02 | RP2040 @ 133 MHz | 64KB + RP2040 ext | RP2040 GPU | RP2040 audio |

---

## Введение

- **Манифест**: почему три платформы, а не тридцать. Глубина побеждает ширину
- **Треугольник обучения**: Spectrum — жёсткие ограничения и прямой доступ к железу; Agon — эволюция Z80 без легаси-оков; NEO6502 — альтернативная архитектурная философия
- **Для кого эта книга**: ты уже знаешь основы ассемблера, хочешь строить реальные проекты на реальном железе
- **Сквозной проект**: от пустого файла до готовой игры на каждой платформе
- **Как читать**: можно идти по «своей» платформе, можно по всем трём параллельно

---

## Часть I: Мастерская — Toolchain и среда разработки

### Глава 1: Среда разработки для каждой платформы

**ZX Spectrum 128K:**
- Ассемблеры: SjASMPlus, Pasmo — настройка, особенности синтаксиса, директивы
- Сборка .tap и .sna файлов, структура формата
- Эмуляторы: Fuse (кроссплатформенный), Spectaculator — настройка для отладки
- DeZog в VS Code: точки останова, просмотр регистров, пошаговое исполнение, watch-выражения
- Запуск на реальном железе: DivMMC EnJOY!, Gotek — подготовка образов
- DivIDE/DivMMC: архитектура, esxDOS, работа с SD-картой из кода, загрузка через RST $08

**Agon Light 2:**
- Ассемблер: ez80asm (родной для Agon), сравнение с Zilog ZDS II
- MOS API: структура вызовов, RST $08 / RST $10, системные функции
- Загрузка по серийному порту, работа с SD-картой через MOS
- ADL-mode vs Z80-совместимый режим: когда что использовать, подводные камни переключения
- Отладка: что доступно, стратегии без полноценного отладчика

**NEO6502:**
- Toolchain: cc65 / 64tass, подключение neo6502.inc
- API-вызовы через страницу $FF00: протокол, синхронизация, ожидание готовности
- Загрузка через USB, работа с файловой системой
- 65C02 vs 6502: новые инструкции (PHX/PLX/PHY/PLY, STZ, BRA, BBS/BBR, TRB/TSB, (zp) без индексации)
- Отладка и мониторинг

**Общее для всех:**
- Makefile для трёх таргетов из одного проекта
- Git для 8-битных проектов: .gitignore, структура репозитория, бинарные ресурсы
- CI через GitHub Actions: автосборка для трёх платформ

**Практика**: «Hello World» на каждой платформе — от пустого файла до запуска на реальном железе. Полный Makefile.

---

### Глава 2: Анатомия трёх машин

**ZX Spectrum 128K:**
- Полная карта памяти: ROM0/ROM1 ($0000-$3FFF), RAM5 ($4000-$7FFF, основной экран), RAM2 ($8000-$BFFF), переключаемые банки ($C000-$FFFF)
- Банки 0-7: какие особые — банк 5 (экран 1), банк 7 (теневой экран), contended-банки (1,3,5,7) — краткая практическая заметка о замедлении, без драматизации
- Порты: ULA ($FE — бордюр, динамик, клавиатура), AY ($FFFD/$BFFD), банковое переключение ($7FFD)
- Тайминги кадра: 70908 T-states на фрейм (PAL), 50 fps, HALT и синхронизация

**Agon Light 2:**
- 24-bit flat memory model: $000000-$07FFFF (512KB), адресация без банков
- MOS API: таблица системных вызовов, VDP-протокол (команды по серийному каналу в ESP32)
- Dual-processor архитектура: eZ80 ↔ ESP32, латентность команд, асинхронность
- GPIO и расширения

**NEO6502:**
- Карта памяти 65C02: zero page ($00-$FF, драгоценная!), стек ($100-$1FF), рабочая RAM, API-страница
- Двойной RP2040: CPU RP2040 эмулирует 65C02, второй RP2040 — GPU/Audio
- Mailbox API: структура команд, группы функций, синхронный vs асинхронный режим
- Доступ к расширенной памяти через API

**Практика**: утилита-инспектор памяти — выводит содержимое указанного адреса/диапазона на экран в реальном времени. Три реализации.

---

## Часть II: Память — архитектуры, клоны, расширения

### Глава 3: Банковое переключение и расширенная память

**ZX Spectrum 128K — стандартная модель:**
- Порт $7FFD: биты 0-2 (банк в $C000), бит 3 (выбор экрана), бит 4 (выбор ROM), бит 5 (блокировка)
- Стратегии использования банков: данные уровней, музыка, графические ресурсы, код
- Теневой экран: double buffering через банк 7 — как использовать для плавной анимации
- Практические паттерны: банк-менеджер, таблица содержимого банков

**Клоны — расширенные раскладки памяти:**

*Pentagon 128/512/1024:*
- Расширенный порт $7FFD, до 1MB RAM
- Турбо-режим 7 MHz
- Особенности тайминга (другой размер кадра — 71680 T-states)

*Scorpion ZS-256:*
- 256KB RAM, порт $1FFD для расширенного банковского переключения
- Профильная память, RAM-диск
- GMX — графический режим 320×200 с 16 цветами (без attribute clash!)

*Profi:*
- До 1MB RAM
- Расширенные графические режимы (512×200)
- CP/M-совместимость и что это значит для карты памяти

*ATM Turbo 2+:*
- 1MB RAM, турборежимы
- Аппаратный скроллинг
- Расширенные графические режимы без attribute clash

*ZX Spectrum Next:*
- 2MB RAM, MMU-система (8 слотов по 8KB — совсем другой подход к банкам)
- Layer 2 (256×192, 8bpp — полноцветный!), тайлмапы, аппаратные спрайты
- Copper — программируемый сопроцессор для растровых эффектов
- DMA-контроллер
- Обратная совместимость: как код 128K работает на Next и что ломается

**DivIDE / DivMMC:**
- Архитектура: 8KB/64KB Flash, автомаппинг, esxDOS
- Загрузка с SD-карты из кода: RST $08, M_GETSETDRV, F_OPEN, F_READ, F_CLOSE
- Практический загрузчик ресурсов: чтение файлов уровней/графики с SD в банки памяти
- DivMMC EnJOY! vs DivIDE: различия для программиста

**Agon Light 2:**
- Flat 512KB — нет банков, но нужна дисциплина организации памяти
- Сегментация: code, data, BSS, стек, буферы, ресурсы
- Загрузка ресурсов с SD через MOS API
- Адресация: работа с 24-bit указателями, far-pointer паттерны

**NEO6502:**
- 64KB видимой памяти, расширенная память через API-вызовы
- Zero page как самый ценный ресурс: планирование распределения
- Загрузка данных из файловой системы через API
- Паттерны работы с памятью больше 64KB

**Практика**: загрузчик ресурсов для каждой платформы — читает сжатый уровень с носителя (SD/банк) и распаковывает в рабочую область. Включает ZX0-распаковщик для Z80 и 65C02.

---

### Глава 4: Сжатие данных

- **ZX0**: алгоритм, формат, реализация распаковщика на Z80 (~70 байт!) и на 65C02
- **ZX7**: альтернатива — когда выбирать ZX0, когда ZX7
- **RLE и delta-кодирование**: для тайловых карт и спрайтовых анимаций
- Сжатие на этапе сборки: интеграция в Makefile, утилиты (zx0, zx7)
- **Практика**: конвейер — PNG → конвертер → сжатие → включение в бинарник → распаковка при загрузке уровня

---

## Часть III: Графика — от пикселя до движка

### Глава 5: Графические архитектуры трёх машин

**ZX Spectrum:**
- ULA-экран: нелинейная раскладка видеопамяти — полный алгоритм вычисления адреса из (x,y)
- Почему строки идут не по порядку: $4000, $4100, $4200... → $4020, $4120... — историческая причина и практические следствия
- Атрибутная сетка: INK, PAPER, BRIGHT, FLASH — 1 байт на 8×8 блок
- Colour clash: почему происходит, как минимизировать (монохромная графика + цветные фоны, chessboard dithering)
- Двойная буферизация через теневой экран (банк 7)
- Бордюр: порт $FE, синхронизация с лучом для полосатых бордюрных эффектов

**Agon Light 2:**
- VDP-режимы: Mode 0-3, разрешения, глубина цвета
- Bitmap API: рисование в буфер, отправка на VDP
- Палитра: программирование цветов, RGBA
- Двойная буферизация через VDP-команды
- Спрайты: аппаратные, до 256 штук, анимация кадров

**NEO6502:**
- Графические режимы через API: разрешения, палитры
- Тайловый режим: карты, наборы тайлов
- Спрайтовый API: создание, перемещение, коллизии
- Рисование примитивов через API

**Практика**: рисуем один и тот же тестовый экран (фон + несколько спрайтов) на трёх платформах. Замеряем fps.

---

### Глава 6: Быстрые спрайты — deep dive

**ZX Spectrum — шесть методов, от простого к экстремальному:**

1. **XOR-спрайты**: простейший случай, ~20 строк кода. Когда допустимо (курсоры, однопиксельные пули)
2. **OR+AND маскированные спрайты**: стандарт индустрии 80-х. Полный код с комментариями по тактам каждой инструкции. Формат хранения: MASK, DATA чередующиеся
3. **Pre-shifted спрайты**: 4 или 8 сдвинутых копий. Расчёт: спрайт 16×16 × 8 сдвигов = сколько памяти? Когда это оправдано
4. **Стековые спрайты (PUSH-метод)**: DI → сохранение SP → подмена SP на адрес экрана → серия PUSH → восстановление SP → EI. Самый быстрый вывод. Полный код. Ограничения: нельзя в прерывании, направление заливки снизу вверх
5. **Compiled sprites**: спрайт = исполняемый код. Генерация на этапе сборки. Каждый пиксельный байт — инструкция LD (HL),n. Самый быстрый, но огромный по памяти
6. **Dirty rectangle**: отслеживание прямоугольников изменённых областей, сохранение/восстановление фона. Комбинируется с любым методом отрисовки

**Agon Light 2:**
- Аппаратные спрайты VDP: создание (VDU 23,27,...), привязка bitmap, позиционирование, фреймы анимации
- Ограничения: количество спрайтов на линию, порядок отрисовки
- Когда рисовать программно в bitmap-буфер вместо аппаратных спрайтов

**NEO6502:**
- Спрайтовый API: определение, перемещение, приоритеты
- Аппаратные коллизии
- Ограничения API: задержки, пропускная способность

**Практика**: 8 анимированных спрайтов 16×16 движутся по экрану с сохранением/восстановлением фона. На Spectrum — OR+AND маска + dirty rectangles. На Agon/NEO — аппаратные спрайты. Цель: 25 fps на всех платформах.

---

### Глава 7: Скроллинг

**ZX Spectrum:**
- **Вертикальный попиксельный скроллинг**: сдвиг всей видеопамяти на 1 пиксель — алгоритм с учётом нелинейной раскладки. Сколько тактов стоит (спойлер: очень дорого). Оптимизации: развёрнутые циклы, LDIR vs LDI×n
- **Горизонтальный скроллинг**: побитовый сдвиг каждого байта строки. RLC/RRC цепочки. Ещё дороже — расчёт бюджета тактов
- **Атрибутный (символьный) скроллинг**: дешёвый скроллинг по 8 пикселей. LDIR на атрибуты + видеопамять
- **Комбинированный**: символьный скроллинг + пиксельный внутри 8-пиксельного окна
- Трюк с теневым экраном: рисуем следующий кадр в банке 7, переключаем — мгновенный «скроллинг»
- **Реальность**: хватит ли тактов на полноэкранный пиксельный скроллинг + спрайты + музыку? Бюджет кадра

**Agon Light 2:**
- Аппаратный скроллинг через VDP offset-регистры
- Тайловые карты с аппаратным скроллингом
- Бесконечный скроллинг: ring-buffer тайлов, подгрузка новых колонок

**NEO6502:**
- Тайловый скроллинг через API
- Обновление карты при движении
- Ограничения пропускной способности API

**Практика**: горизонтально-скроллящийся уровень (платформер). На Spectrum — комбинированный метод (символьный + пиксельный). На Agon/NEO — аппаратный тайловый скроллинг.

---

### Глава 8: Продвинутые графические эффекты

**ZX Spectrum:**
- **Мультиколор**: смена атрибутов по прерыванию каждые 1-2 строки развёртки. Как синхронизироваться с лучом. Практический пример: раскрашенный персонаж без clash
- **Бордюрные эффекты**: OUT ($FE) синхронизированный с тактами развёртки — полосатый бордюр, бордюрная графика
- **Фейды и вайпы**: через манипуляцию атрибутами — мгновенные переходы. Dissolve-эффект, scanline wipe, checkerboard reveal
- **Loading screen**: как art-форма — полноцветный экран, который проявляется полосами

**Agon Light 2:**
- Палитровые эффекты: fade to black через анимацию палитры
- VSync-синхронизация, двойная буферизация для гладких переходов
- Overlay-режимы VDP

**NEO6502:**
- Палитровые манипуляции через API
- Переходы между экранами

**Практика**: title screen с анимированным fade-in и transition-эффектом при старте игры.

---

## Часть IV: Звук и музыка

### Глава 9: AY-3-8910 — полное руководство

- **Архитектура чипа**: 3 тоновых канала (A, B, C), 1 шумовой генератор (общий), envelope-генератор (1 общий)
- **Регистры 0-13** — детальный разбор каждого:
  - R0-R5: тон каналов A/B/C (12-bit период). Формула: freq = clock / (16 × period)
  - R6: период шума (5-bit)
  - R7: микшер — 6 бит: тон on/off + шум on/off для каждого канала. Самый важный регистр. Таблица всех комбинаций
  - R8-R10: амплитуда (4-bit). Бит 4 = envelope mode
  - R11-R12: период envelope (16-bit)
  - R13: форма envelope (4-bit → 10 уникальных форм). Осциллограмма каждой
- **ZX Spectrum 128K**: порты $FFFD (выбор регистра) и $BFFD (запись данных). Порядок обращения, тайминг
- **Agon Light 2**: звуковая система VDP — волновые формы (square, triangle, sawtooth, noise, ...), ADSR-огибающие через команды VDP. Не AY, но можно эмулировать характер звучания
- **Таблица частот**: все ноты всех октав → значения периодов для AY
- **Практика**: звуковой тестер — UI для управления всеми регистрами AY в реальном времени с визуализацией (Spectrum). Аналог на Agon/NEO через их звуковые API.

---

### Глава 10: Музыкальный движок с нуля

**Формат данных:**
- Дизайн компактного формата: Song → Orders → Patterns → Rows → Notes/Effects
- Инструменты: таблица амплитудных огибающих (per-frame volume), арпеджио, portamento
- Компромисс: размер данных vs выразительность

**Движок воспроизведения (ZX Spectrum):**
- **IM2 — полный разбор**: таблица векторов прерываний (257 байт с одинаковым значением, почему $FE), настройка, обработчик
- Обновление AY каждый фрейм из обработчика прерывания
- Бюджет тактов в прерывании: сколько можно потратить, чтобы не сломать основной цикл
- Не-блокирующая архитектура: флаг «фрейм прошёл» для основного цикла

**Конвертация из трекеров:**
- Vortex Tracker II (.pt3) → собственный формат: парсер, конвертер, pipeline
- DefleMask → экспорт, конвертация
- Интеграция конвертации в Makefile

**Agon Light 2:**
- Звуковой API VDP: каналы, установка частоты, длительности, громкости
- MIDI-подобный подход: note on, note off, instrument change
- Музыкальный плеер через таймерные прерывания eZ80

**NEO6502:**
- Sound API: каналы, волновые формы
- Интеграция с game loop

**Практика**: трёхканальная мелодия с ударными (шумовой канал), играющая поверх игры. Три реализации.

---

### Глава 11: Звуковые эффекты

- **Приоритетная система**: музыка играет на 3 каналах, SFX временно захватывает канал → после окончания SFX канал возвращается музыке
- **Процедурные SFX** (таблицы per-frame значений):
  - Взрыв: шум + envelope decay
  - Лазер: быстрый sweep тона вниз
  - Прыжок: короткий sweep вверх
  - Подбор предмета: быстрое арпеджио вверх
  - Столкновение: шум + тон, короткий
  - Меню: тик (один фрейм тона)
  - Смерть: нисходящий тон с шумом
  - Бонус: восходящее арпеджио мажорное
- **Формат хранения**: компактная таблица [register_mask, values...] по кадрам
- **Практика**: библиотека из 8 SFX, интегрированная с музыкальным движком, с системой приоритетов. Три платформы.

---

## Часть V: Игровая архитектура

### Глава 12: Game Loop и управление состояниями

- **Главный цикл**: HALT (ждём прерывание) → Input → Update → Render → goto HALT
- **Бюджет кадра**: Spectrum ~70000 T-states, Agon ~368000 T-states, NEO — зависит от API-нагрузки
- **State machine**: таблица указателей на обработчики состояний (Title → Menu → Game → Pause → GameOver → HiScore)
- **Ввод**:
  - Spectrum: опрос клавиатурных полурядов (IN A,($FE)), Kempston джойстик (IN A,($1F)), Sinclair Interface 2
  - Agon: MOS keyboard API, PS/2 клавиатура
  - NEO: controller/keyboard API
- **Практика**: каркас игры со state machine, плавным игровым циклом, вводом. Три платформы.

---

### Глава 13: Entity System и игровые объекты

- **Структура данных entity**: X (16-bit fixed-point), Y (16-bit), type, state, animation_frame, animation_timer, dx, dy, health, flags — сколько байт на entity
- **Массив entities**: статический массив, итерация, активация/деактивация через флаг
- **Обновление**: цикл по массиву, вызов обработчика по типу (таблица указателей)
- **Сколько entities потянет каждая платформа**: расчёт — обновление + отрисовка + коллизии × N ≤ бюджет кадра
- **Object pool**: переиспользование слотов для пуль, частиц, эффектов
- **Практика**: 16 entities (игрок, 8 врагов, 7 пуль) с обновлением и отрисовкой. Три платформы.

---

### Глава 14: Коллизии и физика

**Fixed-Point арифметика:**
- Формат 8.8: целая часть + дробная часть в одном 16-bit слове
- Сложение/вычитание: обычное 16-bit (бесплатно!)
- Умножение 8.8 × 8.8: полный алгоритм на Z80 (подпрограмма ~30 байт, ~200 тактов) и на 65C02
- Деление: табличный метод для частых случаев
- Синус/косинус: таблица 256 значений (четверть периода + зеркалирование)

**Гравитация и прыжок:**
- velocity_y += gravity (каждый кадр, fixed-point)
- position_y += velocity_y
- Прыжок: velocity_y = -jump_force
- Инерция: velocity_x с трением (сдвиг вправо = деление на 2)

**Коллизии:**
- **AABB** (Axis-Aligned Bounding Box): проверка пересечения двух прямоугольников. Оптимизация через ранний выход (4 сравнения, выход на первом false)
- **Тайловые коллизии**: координаты entity → индекс тайла в карте → проверка типа тайла (проходимый/стена/опасный)
- **Sliding collision response**: при столкновении со стеной — выталкивание по одной оси, скольжение по другой
- **Пространственное разбиение**: для большого количества entities — разбиение экрана на зоны, проверка только внутри одной зоны

**Практика**: платформер-физика — персонаж бегает, прыгает, приземляется, скользит по стенам, собирает объекты. Три платформы.

---

### Глава 15: AI врагов

- **Конечные автоматы (FSM)**: состояния Patrol → Chase → Attack → Retreat → Death
- **Реализация**: текущее состояние в структуре entity, таблица переходов, обработчик каждого состояния
- **Паттерны поведения**:
  - Patrol: движение между двумя точками
  - Chase: движение в сторону игрока (знак dx = sign(player.x - enemy.x))
  - Ambush: ждать на месте до приближения игрока
  - Shoot: периодический выстрел в сторону игрока (создание entity-пули)
  - Flee: движение от игрока при низком health
- **Оптимизация**: не обновлять AI каждый кадр — через кадр или через два
- **Практика**: 4 типа врагов с разным поведением, интегрированные в платформер.

---

## Часть VI: Демосцена

> *В работе над этой частью участвуют эксперты ZX-сцены: Introspec, PSNDCJ, SQ, 4D и другие. Главы содержат экспертные вставки и разбор конкретных эффектов из реальных демо.*

### Глава 16: Философия демосцены и мышление сценера

- **Что такое демо**: не игра, не утилита — цифровое искусство реального времени
- **Категории**: demo, intro (256b, 512b, 1K, 4K, 8K), dentro, musicdisk, slidedemo
- **Платформы и соревнования**: Chaos Constructions, DiHalt, CAFe, Revision — ZX-сцена как живое явление
- **Мышление сценера vs мышление гейм-дева**: в демо нет повторяемости — каждый кадр уникален, нет game loop в привычном смысле, вместо этого — timeline
- **[Экспертная вставка]**: интервью/эссе от участников сцены о подходе к созданию демо

---

### Глава 17: Растровые эффекты и тайминг-трюки (ZX Spectrum)

- **Синхронизация с лучом**: HALT → точный отсчёт тактов → эффект привязан к конкретной строке развёртки
- **Мультиколор**: смена атрибутов быстрее, чем луч рисует строку. Рассчёт: сколько тактов между строками, сколько OUT можно сделать
- **Бордюрные эффекты**: полноцветная графика в бордюре через тайминг-критичные OUT
- **Plasma**: таблица синусов + сложение → атрибутная анимация в реальном времени
- **Цветовые барсы (raster bars)**: горизонтальные полосы через бордюрные OUT
- **Флип-скроллинг в бордюре**: движение графики в области бордюра
- **[Экспертная вставка]**: разбор конкретного эффекта из реального демо — от идеи до реализации с точностью до такта

---

### Глава 18: Процедурная генерация и математические эффекты

- **Tunnel effect**: предрасчёт таблицы angle/distance, отрисовка через lookup
- **Rotozoomer**: вращение и масштабирование текстуры через fixed-point арифметику
- **Fire effect**: клеточный автомат, палитровая анимация (на Spectrum — через атрибуты, на Agon — через реальную палитру)
- **Starfield**: 3D → 2D проекция, перспективная коррекция через деление (табличное)
- **Scrolltexts**: синусоидальный скроллинг, per-char волна
- **Plasma на Spectrum**: атрибутная plasma vs пиксельная plasma (trade-off скорость/качество)
- **Agon Light 2**: те же эффекты, но с полноцветной палитрой — как это меняет подход
- **NEO6502**: процедурные эффекты через API — что реально, а что слишком медленно из-за API-overhead

**Практика**: demo-intro на каждой платформе — starfield → plasma → scrolltext, 30-60 секунд, с музыкой.

---

### Глава 19: Музыка для демо — chiptuning как искусство

- **Форматы**: PT3 (Pro Tracker 3), STC, ASC — какой когда, плееры
- **Чиптюн-композиция**: техники работы с 3 каналами AY — арпеджио, buzz-bass, drum synthesis через шумовой канал, ornaments
- **Turbo Sound (два AY)**: на клонах и Next — 6 каналов, стерео, расширенные возможности
- **Синхронизация с визуальными эффектами**: beat detection, маркеры в музыке, привязка эффектов к ритму
- **[Экспертная вставка]**: процесс создания трека для демо — от идеи до финального PT3

---

### Глава 20: Анатомия реальных демо

- **Разбор 3-5 известных ZX-демо**: структура, ключевые эффекты, как сделаны
- **Timeline engine**: система управления последовательностью эффектов — скрипт, прерывания, синхронизация с музыкой
- **Оптимизация под последний такт**: профилирование, cycle-counting, где выигрывать байты и такты
- **Упаковка**: как уместить demo в 48K/128K/intro-формат
- **[Экспертная вставка]**: post-mortem реального демо от автора — что планировалось, что получилось, что пошло не так

---

## Часть VII: Собираем всё вместе — полная игра

### Глава 21: Дизайн-документ

- Жанр: платформер (горизонтальный скроллинг, 5 уровней, 4 типа врагов, босс)
- Технические требования для каждой платформы
- Карта памяти: что где живёт (код, графика, уровни, музыка, SFX)
- Список ресурсов: тайлсеты, спрайты, уровни, мелодии, SFX

### Глава 22: Реализация — ZX Spectrum 128K

- Интеграция всех модулей: рендерер, скроллинг, спрайты, физика, коллизии, AI, музыка, SFX
- Использование банков: банки 0-3 для уровней/графики, банки 4-6 для музыки/SFX, банк 7 — теневой экран
- Загрузка уровней с ленты/DivMMC
- Оптимизация: профилирование в DeZog, поиск узких мест, финальная полировка
- Загрузочный экран и меню
- Формат выпуска: .tap с загрузчиком

### Глава 23: Реализация — Agon Light 2

- Та же игра, использование аппаратных спрайтов и тайлового скроллинга VDP
- Загрузка ресурсов с SD
- Что меняется в архитектуре без ограничений по памяти
- Сборка и распространение

### Глава 24: Реализация — NEO6502

- Та же игра на 65C02
- Архитектурные контрасты: zero page, стек, индексная адресация — другое мышление
- API-driven подход к графике и звуку
- Сборка и распространение

### Глава 25: Сравнительный анализ

- Одна игра — три платформы: таблицы сравнения
  - Размер кода (байты)
  - Скорость отрисовки (fps, такты на кадр)
  - Размер ресурсов (сжатые vs несжатые)
  - Сложность разработки (субъективно, но честно)
  - Визуальный результат (скриншоты бок о бок)
- **Уроки**: что каждая платформа заставляет делать лучше
- **Портируемость**: что из кода можно переиспользовать, что нет

---

## Приложения

- **A**: Z80 Instruction Set — полная таблица с тактами, размерами, флагами
- **B**: eZ80 расширения — новые инструкции, ADL-mode отличия
- **C**: 65C02 Instruction Set — включая расширения vs оригинальный 6502
- **D**: ZX Spectrum 128K — карта памяти, все порты, тайминги ULA
- **E**: Карты памяти клонов — Pentagon, Scorpion, Profi, ATM, Next (таблицы портов и банков)
- **F**: Agon Light 2 — MOS API reference, VDP-команды
- **G**: NEO6502 — API reference, карта памяти
- **H**: Таблицы частот нот для AY-3-8910 (все октавы, все значения регистров)
- **I**: DivIDE/DivMMC — esxDOS API reference для программиста
- **J**: Инструменты, трекеры, эмуляторы, сообщества, ссылки
