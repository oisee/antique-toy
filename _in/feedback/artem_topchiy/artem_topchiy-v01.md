https://t.me/at_gtn
Артем Топчий

День добрый! Я реально с небольшими замечаниями побеспокою :)

К сожалению, не обнаружил в книге иногда весьма полезной процедуры рассчета адреса экрана на 1 пиксель выше.

Это классический вариант:
up_hl
 dec h
 ld a,h
 and 7
 cp 7
 ret nz
 ld a,l
 sub 32
 ld l,a
 ret c
 ld a,h
 add a,8
 ld h,a
 ret


А это модифицированный мной вариант (может я не первый, но такой вариант не попадался), он на байт короче и на 3 такта быстрее:

up_hl
 dec h
 ld a,h
 cpl ; изменение
 and 7 ; изменение
 ret nz
 ld a,l
 sub 32
 ld l,a
 ret c
 ld a,h
 add a,8
 ld h,a
 ret


Еще в книге описана процедура пересчета из адреса на экране в адрес в атрибутной области. Процедура известная и часто используется. Но тут понадобилось ее оптимизировать для одного частного случая и это получилось :)

Процедура годится исключительно для варианта, когда младшие биты старшего байта адреса на экране равны %111. В моем случае это было при выводе графики по знакоместам сверху вниз. Я вывожу знакоместо и после последнего вывода байта на экран в младших битах h именно %111. И для пересчета адреса в атрибутную область я использую такую процедуру:

  srl h // hl to attributes
  rrc h
  srl h
  set 4,h


Пока все :) Спасибо за книгу! Я еще ее полистаю, хотя английский и плохо знаю.